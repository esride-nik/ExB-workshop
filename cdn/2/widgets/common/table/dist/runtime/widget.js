System.register(["jimu-core","jimu-theme","jimu-arcgis","jimu-ui","jimu-layouts/layout-runtime","jimu-core/react","esri/core/reactiveUtils"],(function(e,t){var i={},a={},o={},s={},l={},n={},r={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.CONSTANTS=e.CONSTANTS,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.MessageManager=e.MessageManager,i.MutableStoreManager=e.MutableStoreManager,i.React=e.React,i.ReactResizeDetector=e.ReactResizeDetector,i.ServiceManager=e.ServiceManager,i.SessionManager=e.SessionManager,i.WidgetState=e.WidgetState,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.cancelablePromise=e.cancelablePromise,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.esri=e.esri,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.privilegeUtils=e.privilegeUtils},function(e){a.Global=e.Global},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){s.AdvancedSelect=e.AdvancedSelect,s.Alert=e.Alert,s.Button=e.Button,s.DataActionList=e.DataActionList,s.DataActionListStyle=e.DataActionListStyle,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Popper=e.Popper,s.Select=e.Select,s.Tab=e.Tab,s.Tabs=e.Tabs,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){l.LayoutItemSizeModes=e.LayoutItemSizeModes},function(e){n.Fragment=e.Fragment},function(e){r.default=e.default}],execute:function(){e((()=>{var e={47001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},63391:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 400 400"><path fill="#000" d="M0 0h400v40H0z"></path><path fill="#000" fill-rule="evenodd" d="M80 55H20v9h60zm100 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 135h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 215h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 295h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 95h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 175h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 255h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 334h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60zM20 374h60v9H20zm160 0h-60v9h60zm40 0h60v9h-60zm160 0h-60v9h60z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M0 39h1v40h98V39h1v40h99V39h1v40h99V39h1v40h99V39h1v360h-1v-40h-99v40h99v1H0V79zm1 320v40h98v-40zm98-1H1v-39h98zm1 1v40h99v-40zm99-1h-99v-39h99zm1 1v40h99v-40zm99-1h-99v-39h99zm1 0h99v-39h-99zM1 318v-38h98v38zm99 0v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zm100 39v-38h99v38zm0-39h99v-39h-99zM1 279h98v-39H1zm0-79v39h98v-39zm98-1H1v-39h98zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zm1 1v39h99v-39zm99-1h-99v-39h99zM1 159v-39h98v39zm99 0v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zm100 40v-39h99v39zm0-40h99V80h-99zM1 119h98V80H1z" clip-rule="evenodd"></path></svg>'},95369:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},33869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},31670:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},85226:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6c2.583 0 5.166 1.45 7.75 4.349a.972.972 0 0 1 0 1.302C13.166 14.551 10.583 16 8 16S2.834 14.55.25 11.651a.972.972 0 0 1 0-1.302C2.834 7.449 5.417 6 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},65283:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},88865:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.992 6.992 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.992 6.992 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},30224:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},48957:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},87830:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},54357:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},135:e=>{"use strict";e.exports=r},26826:e=>{"use strict";e.exports=o},48891:e=>{"use strict";e.exports=i},51315:e=>{"use strict";e.exports=n},74758:e=>{"use strict";e.exports=l},34796:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=s}},t={};function d(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,d),o.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var c={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(c),d.d(c,{__set_webpack_public_path__:()=>ne,default:()=>le});var e,t,i,a,o=d(48891),s=d(34796);!function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(e||(e={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(t||(t={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(i||(i={})),function(e){e.View="VIEW",e.Add="ADD"}(a||(a={}));var l=d(26826),n=d(30726);class r extends o.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.6.0",description:"Add editable to table fields.",upgrader:(e,t)=>{let i=e;return 0===i.layersConfig.length||i.layersConfig.forEach(((e,t)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{editAuthority:!0})));i=i.setIn(["layersConfig",t,"tableFields"],a)})),i}},{version:"1.10.0",description:"Add visible to table fields.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{const a=e.tableFields.map((e=>Object.assign(Object.assign({},e),{visible:!0})));t=t.setIn(["layersConfig",i,"tableFields"],a)})),t}},{version:"1.12.0",description:"Add header setting options.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{e=e.set("headerFontSetting",{backgroundColor:"",fontSize:14,bold:!1,color:""}),t=t.setIn(["layersConfig",i],e)})),t}},{version:"1.13.0",description:'Add "showCount" and "updateText" options.',upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,i)=>{if(e=e.set("showCount",!1).set("updateText",!0),t=t.setIn(["layersConfig",i],e),(null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const a=e.searchFields.split(",")||[];t=t.setIn(["layersConfig",i,"searchFields"],a)}else(null==e?void 0:e.searchFields)||(t=t.setIn(["layersConfig",i,"searchFields"],[]))})),t}},{version:"1.14.0",description:"Update honor webmap options",upgrader:e=>{return t=this,a=void 0,s=function*(){let t=e;const a=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{layerHonorMode:i.Custom})));return t=t.setIn(["layersConfig"],a),t},new((o=void 0)||(o=Promise))((function(e,i){function l(e){try{r(s.next(e))}catch(e){i(e)}}function n(e){try{r(s.throw(e))}catch(e){i(e)}}function r(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(l,n)}r((s=s.apply(t,a||[])).next())}));var t,a,o,s}}]}}const u=new r;var h=d(74758);function v(e,t,i,a){var s,l,n,r,d,c,u,h,v,p;const{id:g,isHeightAuto:m,isWidthAuto:b,headerFontSetting:f,horizontalTag:S}=a,y=null===(l=null===(s=(0,o.getAppStore)().getState())||void 0===s?void 0:s.appConfig)||void 0===l?void 0:l.theme,w="themes/morandi/"===y,x="themes/ink/"===y;return o.css`
    ${"&.table-widget-"+g} {
      .table-indent{
        width: calc(100% - 32px);
        height: calc(100% - 26px);
        margin: 10px 16px 16px;
        display: inline-block;
        ${m&&"min-height: 190px;"};
        ${b&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.colors.palette.light[400]};
          margin: 8px 4px;
        }
        .data-action-btn{
          position: relative;
        }
      }
      .tab-title{
        user-select: none;
        margin: auto;
      }
      .tab-flex{
        width: 100%;
        overflow-x: auto;
        .closeable{
          height: 31px;
        }
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.colors.palette.light[300]};
        .nav-item{
          ${(w||x)&&"height: 30px;"}
        }
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tag-list{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tag-list{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tag-list,
      .horizontal-tag-list{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tag-list{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 32px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: calc(100% - 45px);
      }
      .top-button-list{
        ${i&&"\n          margin: 8px 0;\n          position: absolute;\n          right: 17px;\n          top: 47px;\n        "}
        ${!i&&!S&&"\n          position: absolute;\n          right: 17px;\n        "}
        ${t?"display: none":"display: flex"};
        .top-button{
          display: inline-flex;
          button{
            width: 32px;
            height: 32px;
          }
        }
      }
      .table-search-div{
        position: absolute;
        left: 16px;
        .table-search{
          .search-icon{
            z-index: 2;
          }
          .search-input{
            border: 1px solid ${e.colors.palette.light[400]};
            border-radius: 2px;
            .input-wrapper{
              height: 30px;
              border: none;
            }
          }
        }
      }
      .table-con{
        width: 100%;
        height: 100%;
        .esri-widget{
          background-color: transparent;
        }
        .esri-grid .esri-column__sorter{
          overflow-x: auto;
          overflow-y: hidden;
        }
        .esri-field-column__header-root{
          ${(null==f?void 0:f.backgroundColor)&&`background-color: ${f.backgroundColor};`}
          ${(null==f?void 0:f.fontSize)&&`font-size: ${f.fontSize}px;`}
          ${(null==f?void 0:f.bold)&&"font-weight: bold;"}
          ${(null==f?void 0:f.color)&&`color: ${f.color};`}
        }
        .esri-field-column__header-content{
          width: calc(100% - 26px);
          overflow: unset;
        }
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__header{
          ${!i&&"display: none;"}
        }
        .esri-feature-table__title{
          display: none;
        }
        .esri-feature-table__menu{
          display: none;
        }
        .esri-feature-table__content{
          min-height: 145px;
        }
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .placeholder-table-con{
        height: calc(100% - 40px);
        width: 100%;
        position: relative;
        top: 40px;
        .jimu-widget-placeholder{
          width: 100%;
        }
        .placeholder-alert-con{
          position: absolute;
          right: 10px;
          bottom: 10px;
        }
      }
      .placeholder-reset-con{
        height: calc(100% - 114px);
        width: calc(100% - 32px);
        position: absolute;
        top: 95px;
        z-index: 1001;
        .placeholder-reset-button{
          position: absolute;
          top: calc(50% + 42px);
          left: 50%;
          transform: translateX(-50%) translateY(-50%);
        }
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
      .refresh-loading-con {
        right: 0;
        height: ${o.polished.rem(16)};
        .auto-refresh-loading {
          background: ${o.polished.rgba(null===(d=null===(r=null===(n=e.colors)||void 0===n?void 0:n.palette)||void 0===r?void 0:r.light)||void 0===d?void 0:d[100],.65)};
          color: ${null===(c=e.colors)||void 0===c?void 0:c.black};
          font-size: ${o.polished.rem(12)};
          line-height: ${o.polished.rem(16)};
          ${!t&&`padding: 0 ${o.polished.rem(7)};`}
          .icon-btn{
            padding: ${o.polished.rem(1)};
          }
        }
      }
      .table-count{
        left: 0;
        bottom: 0;
        height: ${o.polished.rem(16)};
        .total-count-text{
          background: ${o.polished.rgba(null===(v=null===(h=null===(u=e.colors)||void 0===u?void 0:u.palette)||void 0===h?void 0:h.light)||void 0===v?void 0:v[100],.65)};
          color: ${null===(p=e.colors)||void 0===p?void 0:p.black};
          font-size: ${o.polished.rem(12)};
          line-height: ${o.polished.rem(16)};
          padding: 0 ${o.polished.rem(7)};
        }
      }
      .dropdown-list-container{
        ${i&&"\n          position: absolute;\n          right: 17px;\n          top: 55px;\n        "}
        ${!i&&!S&&"\n          position: absolute;\n          right: 17px;\n        "}
        .dropdown-list{
          ${!t&&"display: none;"}
          width: 32px;
          height: 32px;
        }
      }
    }
  `}function p(e,t,i){const a=i||"jimuName",o=e.length>t.length,s=o?t:e;return(o?e:t).filter((e=>!s.some((t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))))}function g(e){return o.css`
    .esri-button-menu__item .esri-button-menu__item-label{
      padding: 4px 15px !important;
    }
    .table-popup-search{
      .search-icon{
        z-index: 2;
      }
      .popup-search-input{
        border: 1px solid ${e.colors.palette.light[400]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
    .table-action-option{
      width: 100%;
      display: inline-flex;
      flex-direction: row;
      .table-action-option-tab{
        margin: auto 8px;
      }
      .table-action-option-close{
        flex: 1;
        button{
          :hover {
            color: ${e.colors.white};
          }
          float: right;
        }
      }
    }
    .esri-popover--open{
      z-index: 1005 !important;
      .esri-date-picker__calendar{
        background-color: ${e.colors.white};
      }
    }
    .table-hide-hover-color{
      color: unset !important;
      border: none !important;
      &:hover{
        color: unset !important; /* use color of dropdown item */
      }
    }
  `}var m=d(30224),b=d.n(m);const f=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:b()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var S=d(33869),y=d.n(S);const w=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:y()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var x=d(55339),T=d.n(x);const j=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:T()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var I=d(65283),C=d.n(I);const A=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:C()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var O=d(31670),D=d.n(O);const M=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:D()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var z=d(88865),F=d.n(z);const N=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:F()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var L=d(85226),P=d.n(L);const R=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:P()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var E=d(87830),V=d.n(E),H=d(48957),B=d.n(H);const U=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component has-rtl-svg",i);return t?o.React.createElement(t,Object.assign({className:s,src:V(),srcRTL:B()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var _=d(95369),k=d.n(_);const $=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:k()},a)):o.React.createElement("svg",Object.assign({className:s},a))};d(54357);var Q=d(51315),W=d(135),G=d(88866),q=d.n(G);const J=e=>{const t=window.SVG,{className:i}=e,a=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(i[a[o]]=e[a[o]])}return i}(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:q()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var K=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};const{BREAK_POINTS:X,SELECTION_DATA_VIEW_ID:Y,DATA_VIEW_ID_FOR_NO_SELECTION:Z}=o.CONSTANTS,ee={where:"1=1",sqlExpression:null},te=d(63391),ie=[o.DataSourceStatus.NotReady,o.DataSourceStatus.LoadError],ae=new(0,o.esri.Sanitizer),oe=Object.assign({},{_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",refresh:"Refresh",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLabel:"{layer} table selection",tableCount:"Total: {total} | Selection: {selected}",_action_addToTable_label:"Add to table"},n.defaultMessages);class se extends o.React.PureComponent{constructor(e){var s,l;super(e),this.promises=[],this.FeatureTable=null,this.FeatureLayer=null,this.TableTemplate=null,this.geometryEngine=null,this.Polygon=null,this.getTimezone=e=>o.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone()),this.onSettingChangeRuntime=()=>{var e,t,i,a;const{id:s}=this.props,l=(null===(t=null===(e=this.props)||void 0===e?void 0:e.stateProps)||void 0===t?void 0:t.optionChangeSuggestion)||!1,n=(null===(a=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===a?void 0:a.removeLayerFlag)||!1;if(l&&(this.setState({isShowSuggestion:!1}),this.props.dispatch(o.appActions.widgetStatePropChange(s,"optionChangeSuggestion",!1))),n){const e=document.getElementsByClassName("esri-popover esri-popover--open");e&&e.length>0&&e[0].remove(),this.props.dispatch(o.appActions.widgetStatePropChange(s,"removeLayerFlag",!1))}},this.onFilterChange=e=>{var t,i;const{dataSource:a,activeTabId:o}=this.state,{viewInTableObj:s}=this.props;if(s&&o===e&&Object.keys(s).findIndex((t=>t===e))>-1){const o=s[e].daLayerItem.dataActionDataSource,l=s[e].daLayerItem.useDataSource;let n;o?n=o.getCurrentQueryParams():l&&a&&(n=a.getCurrentQueryParams());const r=null===(i=null===(t=this.table)||void 0===t?void 0:t.layer)||void 0===i?void 0:i.definitionExpression;void 0!==r&&r!==(null==n?void 0:n.where)&&(this.table.layer.definitionExpression=null==n?void 0:n.where)}},this.settingOptionsChange=(e,t)=>{let i=!1;if((null==e?void 0:e.id)!==(null==t?void 0:t.id))return i;const a=["enableAttachements","enableEdit","allowCsv","enableSelect","selectMode","layerHonorMode","tableFields"],s=["tableFields"];for(const l of a)if(s.includes(l)?!o.lodash.isDeepEqual(null==e?void 0:e[l],null==t?void 0:t[l]):(null==e?void 0:e[l])!==(null==t?void 0:t[l])){i=!0;break}return i},this.getFieldsFromDatasource=()=>{var e;const{config:t}=this.props,{layersConfig:i}=t,{activeTabId:a}=this.state,o=this.getDataActionTable(),s=i.asMutable({deep:!0}).concat(o).find((e=>e.id===a)),l=(null==s?void 0:s.dataActionDataSource)||this.dsManager.getDataSource(null===(e=s.useDataSource)||void 0===e?void 0:e.dataSourceId),n=null==l?void 0:l.getSchema(),r=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[],d=["CreationDate","Creator","EditDate","Editor","GlobalID"];let c=r.filter((e=>!d.includes(e.jimuName)));return(null==c?void 0:c.length)>50&&(c=c.slice(0,50)),{allFields:r,tableFields:c}},this.onToolStyleChange=(e,t)=>{e<X[0]?this.setState({mobileFlag:!0}):this.setState({mobileFlag:!1}),e<300?this.setState({searchToolFlag:!0}):this.setState({searchToolFlag:!1}),e<430?this.setState({bottomResponsiveFlag:!0}):this.setState({bottomResponsiveFlag:!1}),this.setState({widgetWidth:e})},this.onDataSourceCreated=e=>{this.setState({dataSource:e});const t=(null==e?void 0:e.dataViewId)===Y,i=(null==e?void 0:e.dataViewId)&&"output"!==(null==e?void 0:e.dataViewId)&&!t,a=!!e.getMainDataSource().getDataView(Z);!this.updatingTable&&(t&&a||i)&&(this.updatingTable=!0,this.destoryTable().then((()=>{this.createTable(e)})))},this.updateGeometryAndSql=e=>{var t;if(!(null===(t=this.table)||void 0===t?void 0:t.layer))return;const{tableLoaded:i}=this.state,a=null==e?void 0:e.getCurrentQueryParams(),s=this.table.layer.definitionExpression;""===s&&"1=1"===(null==a?void 0:a.where)||s===(null==a?void 0:a.where)||(i?(this.lastSql="",this.table.layer.definitionExpression=null==a?void 0:a.where):this.lastSql=null==a?void 0:a.where),o.dataSourceUtils.changeJimuFeatureLayerQueryToJSAPILayerQuery(e,(0,o.Immutable)(a)).then((e=>{var t,i;if(!e)return;const{geometry:a,distance:s,units:l}=e;if(!a)return;const n=null==a?void 0:a.spatialReference,r=null==a?void 0:a.type,{isWGS84:d,isWebMercator:c}=n,u=d||c?this.geometryEngine.geodesicBuffer:this.geometryEngine.buffer,h=null===(i=null===(t=this.table)||void 0===t?void 0:t.filterGeometry)||void 0===i?void 0:i.toJSON();if("polygon"!==r&&s&&s<=0){const e=new this.Polygon({rings:[]});o.lodash.isDeepEqual(h,null==e?void 0:e.toJSON())||(this.table.filterGeometry=e)}else if(s&&l){const e=u(a,s,l);o.lodash.isDeepEqual(h,null==e?void 0:e.toJSON())||(this.table.filterGeometry=e)}else this.table.filterGeometry=a})),setTimeout((()=>{this.asyncSelectedRebuild(e)}),500)},this.onDataSourceInfoChange=(e,t)=>{var i,s,l,n;if(!e)return void this.destoryTable().then((()=>{this.setState({emptyTable:!0})}));this.dataSourceChange=!0,(null==e?void 0:e.status)===o.DataSourceStatus.Loaded&&(null==t?void 0:t.status)===o.DataSourceStatus.Loaded&&(this.dataSourceChange=!1);let{dataSource:r}=this.state;const{selectQueryFlag:d,activeTabId:c,selfDsChange:u}=this.state,{config:h}=this.props,{layersConfig:v}=h,p=this.getDataActionTable(),g=v.asMutable({deep:!0}).concat(p).find((e=>e.id===c)),m=null==g?void 0:g.useDataSource,b=g.dataActionType===a.View;if(!r&&m||!b&&(null==r?void 0:r.id)!==(null==m?void 0:m.dataSourceId)){if(r=this.dsManager.getDataSource(null==m?void 0:m.dataSourceId),!r)return void this.setState({emptyTable:!0})}else if(!r&&!m)return;const f=(null==r?void 0:r.dataViewId)===Y&&0===(null===(i=null==r?void 0:r.getSourceRecords())||void 0===i?void 0:i.length);if(!g.dataActionObject){if(!(null==e?void 0:e.status)||(null==e?void 0:e.status)===o.DataSourceStatus.NotReady||f)return void this.destoryTable().then((()=>{this.setState({notReady:!0,emptyTable:!0})}));this.setState({notReady:!1,emptyTable:!1})}const S=this.getLoadingStatus(r,null==e?void 0:e.status),y=(null==r?void 0:r.getAutoRefreshInterval())||0;this.toggleAutoRefreshLoading(r,S,y),this.setState({showLoading:S,interval:y});const w=null==t?void 0:t.selectedIds,x=null==e?void 0:e.selectedIds,T=null==t?void 0:t.sourceVersion,j=null==e?void 0:e.sourceVersion,I=null==e?void 0:e.gdbVersion,C=null==t?void 0:t.gdbVersion,A=null==e?void 0:e.version,O=null==t?void 0:t.version,D=(null===(s=null==g?void 0:g.useDataSource)||void 0===s?void 0:s.dataSourceId)===(null==r?void 0:r.id)&&(null==t?void 0:t.status)===(null==e?void 0:e.status)&&(null==t?void 0:t.instanceStatus)===(null==e?void 0:e.instanceStatus)&&(null==e?void 0:e.widgetQueries)===(null==t?void 0:t.widgetQueries)&&w===x&&(T===j||j===this.tableSourceVersion+1)&&I===C;if(ie.includes(null==e?void 0:e.status)||this.updatingTable||D)return;this.setState({selectRecords:null==r?void 0:r.getSelectedRecords()});const M=j!==T,z=A!==O,F=(null===(l=null==g?void 0:g.useDataSource)||void 0===l?void 0:l.dataSourceId)!==(null==r?void 0:r.id),N=(!(null==t?void 0:t.status)||ie.includes(null==t?void 0:t.status))&&e&&!ie.includes(null==e?void 0:e.status)&&(null==e?void 0:e.instanceStatus)!==o.DataSourceStatus.NotCreated,L=w!==x&&(0!==(null==w?void 0:w.length)||0!==(null==x?void 0:x.length)),P=(null==e?void 0:e.status)===(null==t?void 0:t.status)&&(null==e?void 0:e.instanceStatus)===(null==t?void 0:t.instanceStatus),R=null===(n=null==r?void 0:r.getDataSourceJson())||void 0===n?void 0:n.isOutputFromWidget,E=!(g.dataActionObject||(null==e?void 0:e.status)!==o.DataSourceStatus.Unloaded||(null==e?void 0:e.instanceStatus)!==o.DataSourceStatus.Created||L||P||R);if(N||F||E||M||z){if((null==r?void 0:r.dataViewId)!==Y&&(null==g?void 0:g.dataActionObject))return;if(!this.dataActionCanLoad)return;return this.updatingTable=!0,void this.destoryTable().then((()=>{this.createTable(r)}))}w!==x&&(d?(this.asyncSelectedWhenSelection(x||(0,o.Immutable)([])),setTimeout((()=>{this.asyncSelectedRebuild(r)}),500)):u?this.setState({selfDsChange:!1}):setTimeout((()=>{this.asyncSelectedRebuild(r)}),500))},this.compareAndUpdateTable=(e,t,i)=>{const{dataSource:a,activeTabId:o}=this.state,{config:s}=this.props,{layersConfig:l}=s,n=this.getDataActionTable(),r=l.asMutable({deep:!0}).concat(n).find((e=>e.id===o)),{widgetQueries:d,gdbVersion:c,sourceVersion:u}=t,{widgetQueries:h,gdbVersion:v,needRefresh:p,sourceVersion:g}=e,m=c&&v&&v!==c&&this.table,b=!r.dataActionObject&&h!==d,f=i&&u!==g;return m?(this.table.layer.gdbVersion=v,void this.onTableRefresh()):p?void this.onTableRefresh():f?(this.updatingTable=!0,void this.destoryTable().then((()=>{this.createTable()}))):void(b&&this.updateGeometryAndSql(a))},this.onQueryRequired=(e,t)=>{var i,a,s,l,n,r,d;const{dataSource:c}=this.state;if((null===(s=null===(a=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===a?void 0:a.dataActionActiveObj)||void 0===s?void 0:s.dataActionTable)||!t)return;const u=null==c?void 0:c.id,h=null==c?void 0:c.getCurrentQueryParams(),v=null==h?void 0:h.time,p=null===(l=this.table)||void 0===l?void 0:l.layer;if(v){const e=o.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(v),t=null==p?void 0:p.timeExtent;((null==v?void 0:v[0])!==(null===(n=null==t?void 0:t.start)||void 0===n?void 0:n.getTime())||(null==v?void 0:v[1])!==(null===(r=null==t?void 0:t.end)||void 0===r?void 0:r.getTime()))&&p&&(p.timeExtent=e)}else p&&(p.timeExtent=null);const g=null==e?void 0:e[u],m=null==t?void 0:t[u],b=null===(d=null==c?void 0:c.belongToDataSource)||void 0===d?void 0:d.id,f=null==e?void 0:e[b],S=null==t?void 0:t[b];(g||f)&&(f?this.compareAndUpdateTable(f,S,!0):this.compareAndUpdateTable(g,m))},this.getLayerObjectIdField=()=>{var e,t,i;const{dataSource:a}=this.state;return(null===(t=null===(e=this.table)||void 0===e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(i=null==a?void 0:a.layer)||void 0===i?void 0:i.objectIdField)||"OBJECTID"},this.asyncSelectedWhenSelection=e=>{const{dataSource:t}=this.state,i=this.getLayerObjectIdField(),a=t&&t.getCurrentQueryParams();let o=!0;e.forEach((e=>{e||(o=!1)}));const s=e.length>0&&o?`${i} IN (${e.map((e=>e)).join()})`:a.where;this.table&&this.table.layer&&(this.table.clearSelectionFilter(),this.table.layer.definitionExpression=s)},this.getFeatureLayer=(e,t)=>{var i,a,s,l;const n=e,r=null===(i=null==e?void 0:e.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance;let d;if((null==t?void 0:t.length)>0)return o.dataSourceUtils.createFeatureLayerByRecords(n,t);{const t=e&&e.getCurrentQueryParams();if(r){const e={returnGeometry:!0};return n.dataViewId!==Y||n.sourceRecords&&0!==n.sourceRecords.length||n.getMainDataSource().getDataView(Z)&&(e.pageSize=null===(l=null===(s=null===(a=n.getMainDataSource().getDataSourceJson())||void 0===a?void 0:a.dataViews)||void 0===s?void 0:s[Z])||void 0===l?void 0:l.pageSize),n.query(e).then((({records:e})=>K(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return o.dataSourceUtils.createFeatureLayerByRecords(n,t)}))))}if(!this.FeatureLayer)return Promise.resolve(d);if(n.itemId){const e=parseInt(n.layerId),i={portalItem:{id:n.itemId,portal:{url:n.portalUrl}},definitionExpression:t.where,layerId:e||void 0};n.url&&(i.url=n.url),d=new this.FeatureLayer(i)}else{if(!n.url)return n.layer?null==n?void 0:n.createJSAPILayerByDataSource().then((e=>e)):Promise.resolve(d);d=new this.FeatureLayer({definitionExpression:t.where,url:n.url})}}return r?Promise.resolve(d):d.load().then((()=>K(this,void 0,void 0,(function*(){return yield Promise.resolve(d)}))))},this.getDsAccessibleInfo=e=>e?(0,o.esri.restRequest.request)(`${e}?f=json`).then((e=>!Object.keys(e).includes("error"))).catch((e=>!1)):Promise.resolve(!1),this.getFieldEditable=(e,t)=>{const i=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!i||(null==i?void 0:i.editable)},this.dsAsyncSelectTable=(e,t,i,a)=>{const{id:s}=this.props,l=this.table,n=this.getLayerObjectIdField(),r=t&&t.length>0?`${n} IN (${t.map((e=>e.dataSource?e.getId():e)).join()})`:"";a&&e.clearSelection();const d=t=>{o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(s,t)),l.layer.queryFeatureCount().then((e=>{0===e?this.setState({emptyData:!0}):this.setState({emptyData:!1})})),t.length>0?e.selectRecordsByIds(t.map((e=>e.getId())),t):e.clearSelection(),i||setTimeout((()=>{this.asyncSelectedRebuild(e)}),500)};r?e.query({where:r,returnGeometry:!0}).then((e=>{const t=null==e?void 0:e.records;t&&d(t)})):d([])},this.isDataSourceAccessible=(e,t,i)=>{var a;const o=!!this.dsManager.getDataSource(e);let s=!1;return s=!!i||(t?o:(null===(a=this.props.useDataSources)||void 0===a?void 0:a.filter((t=>e===t.dataSourceId)).length)>0),s},this.resetUpdatingStatus=(e=!1)=>{this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.updatingTable=!1,this.setState({emptyTable:e})},this.getDsCapabilities=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.getIsAdvancedPermission=e=>K(this,void 0,void 0,(function*(){var t;if(!e)return!1;const i=yield null==e?void 0:e.fetchItemInfo().then((e=>e)).catch((e=>{console.error(e)}));if(!i||!i.url)return!1;const a=null===(t=o.ServiceManager.getInstance().getServerInfoByServiceUrl(i.url))||void 0===t?void 0:t.owningSystemUrl;if(!a)return!1;const s=o.SessionManager.getInstance().getSessionByUrl(a);if(!s)return!1;const l=yield s.getUser(),n="org_admin"===(null==l?void 0:l.role)&&(null==i?void 0:i.isOrgItem),r=i.owner===(null==l?void 0:l.username),d=yield o.privilegeUtils.isItemInTheUpdatedGroup(i.id,s);return n||r||d})),this.getLayerAndNewTable=(e,s,l)=>{const{tableShowColumns:n,selectQueryFlag:r}=this.state,{id:d}=this.props,c=this.currentRequestId+1;this.currentRequestId++;const u=(null==e?void 0:e.type)===o.AllDataSourceTypes.SceneLayer?e.getAssociatedDataSource():e;if(u){const h=()=>o.privilegeUtils.checkExbAccess(o.privilegeUtils.CheckTarget.Experience).then((e=>{var t;return null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.canEditFeature})),v=o.cancelablePromise.cancelable(this.getFeatureLayer(u,l).then((v=>K(this,void 0,void 0,(function*(){var g,m,b,f,S;if(!(c===this.currentRequestId&&v&&this.FeatureTable&&this.refs.currentEl&&this.refs.tableContainer&&document))return void this.resetUpdatingStatus();const y=(null==v?void 0:v.layer)||v;let w=null;if((null==l?void 0:l.length)>0){this.viewTableId++;const e=`${u.id}-${d}-view_in_table-${this.viewTableId}`,t=`${null===(g=u.belongToDataSource)||void 0===g?void 0:g.getDataSourceJson().sourceLabel}-${this.viewTableId}`,i={id:e,dataSourceJson:(0,o.Immutable)({id:e,type:o.DataSourceTypes.FeatureLayer,sourceLabel:t}),layer:y};w=yield this.dsManager.createDataSource(i),this.setState({dataSource:w})}const x=yield this.getDsAccessibleInfo(null==v?void 0:v.url),T=yield h(),j=yield this.getIsAdvancedPermission(w||e),I=null==y?void 0:y.userHasFullEditingPrivileges,C=null===(m=null==y?void 0:y.editingEnabled)||void 0===m||m,A=s.layerHonorMode===i.Webmap,O=(A||s.enableEdit)&&(x||T);let D=!1;D=!!(j||I&&C)||!(I&&!C)&&O;const M=null==u?void 0:u.getSchema(),z=null==e?void 0:e.getCurrentQueryParams(),F=(null==z?void 0:z.orderByFields)||[],N={};F.forEach(((e,t)=>{var i;const a=e.split(" ");N[a[0]]={direction:null===(i=a[1])||void 0===i?void 0:i.toLowerCase(),initialSortPriority:t}}));const L=null==e?void 0:e.getLayerDefinition(),{allFields:P}=this.getFieldsFromDatasource(),R=p(P,n?n.map((e=>({jimuName:e.value}))):s.tableFields.filter((e=>e.visible))).map((e=>e.jimuName));let E;if(A){const t=null==e?void 0:e.getPopupInfo(),i=(null==t?void 0:t.fieldInfos)||[],a=Object.keys(null==M?void 0:M.fields),o=i.filter((e=>a.includes(e.fieldName))),s=((null===(b=null==L?void 0:L.fields)||void 0===b?void 0:b.length)>0?L.fields:P).filter((e=>a.includes(e.jimuName||e.name)));E=(null==t?void 0:t.fieldInfos)?new this.TableTemplate({columnTemplates:o.map((e=>{var t;const i=e.fieldName;return Object.assign(Object.assign(Object.assign({},e),{editable:null!==(t=e.isEditable)&&void 0!==t&&t}),N[i]?N[i]:{})}))}):new this.TableTemplate({columnTemplates:s.map((e=>{const t=e.jimuName||e.name;return Object.assign(Object.assign(Object.assign({},e),{fieldName:t,label:e.alias||e.name,editable:this.getFieldEditable(L,t),visible:!0}),N[t]?N[t]:{})}))})}else A||(E=new this.TableTemplate({columnTemplates:s.tableFields.map((e=>{var t;const i=e.jimuName||e.name,a=null===(t=null==M?void 0:M.fields)||void 0===t?void 0:t[i];return Object.assign(Object.assign(Object.assign({fieldName:i,label:null==a?void 0:a.alias},D?{editable:this.getFieldEditable(L,i)&&(null==e?void 0:e.editAuthority)}:{}),{visible:R.indexOf(i)<0}),N[i]?N[i]:{})}))}));const V=null==L?void 0:L.capabilities,H=this.getDsCapabilities(V,"delete");if(this.setState({notAllowDel:!H}),0===(null===(f=null==E?void 0:E.columnTemplates)||void 0===f?void 0:f.length)&&!A)return void this.resetUpdatingStatus();if(D){const t=this;y.on("edits",(function(i){var a,o,s;const{addedFeatures:l,updatedFeatures:n,deletedFeatures:r}=i,d=l&&l.length>0,c=n&&n.length>0,u=r&&r.length>0;if(d||c||u){const l=null===(o=null===(a=null==i?void 0:i.edits)||void 0===a?void 0:a.updateFeatures)||void 0===o?void 0:o[0];if(l){const i=e.buildRecord(l),a=e.getInfo();t.tableSourceVersion=null!==(s=null==a?void 0:a.sourceVersion)&&void 0!==s?s:0,e.afterUpdateRecord(i)}}}))}const B=e.getGDBVersion();B&&(y.gdbVersion=B);const U=null==z?void 0:z.time;if(U){const e=o.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(U);y.timeExtent=e}this.refs.tableContainer.innerHTML="";const _=document.createElement("div");_.className=`table-container-${d}`,this.refs.tableContainer.appendChild(_),this.table=new this.FeatureTable(Object.assign(Object.assign({layer:y,container:_,visibleElements:{header:!0,menu:!0,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1},selectionColumn:!1},menuConfig:{}},E?{tableTemplate:E}:{}),{multiSortEnabled:!0,attachmentsEnabled:s.enableAttachements,editingEnabled:D,timeZone:this.getTimezone(e)})),W.default.watch((()=>{var e,t;return null===(t=null===(e=this.table)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.size}),(e=>{this.setState({tableTotal:e})})),W.default.watch((()=>{var e,t;return null===(t=null===(e=this.table)||void 0===e?void 0:e.highlightIds)||void 0===t?void 0:t.length}),(e=>{this.setState({tableSelected:e})})),W.default.watch((()=>{var e;return null===(e=this.table)||void 0===e?void 0:e.columns.some((e=>!!e.activeEditInfo))}),(e=>{this.setState({isTableEditing:e})})),W.default.watch((()=>this.table.state),(e=>{"loaded"===e?this.setState({tableLoaded:!0}):this.setState({tableLoaded:!1})}));const k=s.dataActionType===a.Add;s.dataActionObject||setTimeout((()=>{r&&this.asyncSelectedWhenSelection((0,o.Immutable)(e.getSelectedRecordIds()||[]))}),500),k&&setTimeout((()=>{this.asyncSelectedRebuild(e)}),500);const $=this.table;if(s.enableSelect){const i=({context:i,native:o})=>{this.state.isTableEditing||(clearTimeout(this.timerFn),this.timerFn=setTimeout((()=>{var o,l;this.setState({selfDsChange:!0});const n=i.item.objectId;s.selectMode===t.Single&&this.table.highlightIds.removeAll(),i.selected?this.table.highlightIds.remove(n):this.table.highlightIds.add(n);const r=null===(l=null===(o=$.grid)||void 0===o?void 0:o.highlightIds)||void 0===l?void 0:l.toArray();0===(null==r?void 0:r.length)&&(this.state.selectQueryFlag&&this.table.clearSelectionFilter(),this.resetTableExpression(),this.setState({selectQueryFlag:!1})),s.dataActionType===a.View?this.dsAsyncSelectTable(w,r,!0):this.dsAsyncSelectTable(e,r,!0)}),200))};$.grid.on("row-click",i)}null===(S=null==$?void 0:$.domNode)||void 0===S||S.addEventListener("dblclick",(e=>{clearTimeout(this.timerFn)})),l||this.updateGeometryAndSql(e),this.resetUpdatingStatus()})))));0!==this.promises.length&&this.promises.forEach((e=>{e.cancel()})),this.promises.push(v)}},this.createTable=e=>{var t,i,o;const{config:s}=this.props,{layersConfig:l}=s,{activeTabId:n}=this.state;let{dataSource:r}=this.state;e&&(r=e);const d=this.getDataActionTable(),c=l.asMutable({deep:!0}).concat(d).find((e=>e.id===n));if(!c)return this.dataActionCanLoad=!0,void(this.updatingTable=!1);const{dataActionDataSource:u}=c;if(u&&(r=u),!r||ie.includes(null===(t=null==r?void 0:r.getInfo())||void 0===t?void 0:t.status))return this.dataActionCanLoad=!0,void(this.updatingTable=!1);const h=c.dataActionObject;if((null==r?void 0:r.dataViewId)===Y){if(!(null===(i=null==r?void 0:r.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance)||!h&&0===(null==r?void 0:r.getSourceRecords().length))return void this.resetUpdatingStatus(!0);this.setState({emptyTable:!1})}const v=u?null==u?void 0:u.id:null===(o=null==c?void 0:c.useDataSource)||void 0===o?void 0:o.dataSourceId;if(c.dataActionType!==a.View&&v!==(null==r?void 0:r.id))return this.dataActionCanLoad=!0,void(this.updatingTable=!1);if(!this.isDataSourceAccessible(v,h,u))return void this.resetUpdatingStatus(!0);const p=this.dataActionTableRecords[c.id];h&&v&&(r=this.dsManager.getDataSource(v)),this.getLayerAndNewTable(r,c,p)},this.asyncSelectedRebuild=e=>{var t,i,a;const{selectRecords:s}=this.state;let l=null==e?void 0:e.getSelectedRecordIds();const n=(null===(t=null==e?void 0:e.belongToDataSource)||void 0===t?void 0:t.getSelectedRecordIds())||[];e.isDataView&&l.length!==n.length&&(l=n||l),(null===(a=null===(i=this.table)||void 0===i?void 0:i.highlightIds)||void 0===a?void 0:a.removeAll)&&this.table.highlightIds.removeAll();const r=null==e?void 0:e.getSelectedRecords();r&&!o.lodash.isDeepEqual(s,r)&&this.setState({selectRecords:r}),(null==l?void 0:l.length)>0&&l.forEach((e=>{var t,i;e&&(null===(i=null===(t=this.table)||void 0===t?void 0:t.highlightIds)||void 0===i?void 0:i.add)&&this.table.highlightIds.add(parseInt(e))}))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:oe[e]},t),this.onTagClick=e=>{const{id:t}=this.props;this.setState({activeTabId:e,selectQueryFlag:!1,tableShowColumns:void 0,tableSelected:0}),this.props.dispatch(o.appActions.widgetStatePropChange(t,"activeTabId",e))},this.handleTagChange=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,{id:a}=this.props;this.setState({activeTabId:i,selectQueryFlag:!1,tableSelected:0}),this.props.dispatch(o.appActions.widgetStatePropChange(a,"activeTabId",i))},this.onShowSelection=()=>{const{selectQueryFlag:e}=this.state;e?(this.table.clearSelectionFilter(),this.resetTableExpression()):this.table.filterBySelection(),this.setState({selectQueryFlag:!e})},this.resetTableExpression=()=>{var e;const{dataSource:t}=this.state;if(null===(e=this.table)||void 0===e?void 0:e.layer){const e=t&&t.getCurrentQueryParams();this.table.layer.definitionExpression=e.where}},this.resetTable=()=>{const{id:e}=this.props,{selectQueryFlag:t,dataSource:i}=this.state;t&&(this.resetTableExpression(),this.setState({selectQueryFlag:!1,selfDsChange:!0})),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(e,[])),setTimeout((()=>{this.setState({searchText:""}),i.clearSelection(),i.updateQueryParams(ee,e),this.table&&this.table.highlightIds.removeAll(),this.table&&this.table.clearSelectionFilter()}),500)},this.onSelectionClear=()=>{this.resetTable()},this.onTableRefresh=()=>{this.table&&this.table.refresh()},this.onDeleteSelection=()=>{this.table&&this.table.deleteSelection(!0)},this.getQueryOptions=e=>{let t="1=1",i=null;const{useDataSources:a}=this.props,{searchText:s,dataSource:l}=this.state,n=a&&a[0];if(!l||!n)return null;if(!l.query)return null;if(s&&e.enableSearch&&e.searchFields){const a=o.dataSourceUtils.getSQL(s,e.searchFields,l,null==e?void 0:e.searchExact);t=a.sql,i=a}return{where:t,sqlExpression:i}},this.handleChange=e=>{e?this.setState({searchText:e,isShowSuggestion:(null==e?void 0:e.length)>2},(()=>{clearTimeout(this.suggestionsQueryTimeout),this.suggestionsQueryTimeout=setTimeout((()=>{this.getSearchSuggestions(e)}),200)})):this.setState({searchText:e,isShowSuggestion:!1,searchSuggestion:[]},(()=>{this.handleSubmit()}))},this.getSearchSuggestions=e=>{var t;const{config:i}=this.props,{dataSource:a,activeTabId:s}=this.state;if((null==e?void 0:e.length)<3)return!1;(function(e,t,i){return a=this,s=void 0,n=function*(){const a={searchText:e,searchFields:(null==t?void 0:t.searchFields)||[],dataSource:i,exact:null==t?void 0:t.searchExact};return o.dataSourceUtils.querySuggestions(a)},new((l=void 0)||(l=Promise))((function(e,t){function i(e){try{r(n.next(e))}catch(e){t(e)}}function o(e){try{r(n.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof l?a:new l((function(e){e(a)}))).then(i,o)}r((n=n.apply(a,s||[])).next())}));var a,s,l,n})(e,null===(t=i.layersConfig)||void 0===t?void 0:t.find((e=>e.id===s)),a).then((e=>{this.setState({searchSuggestion:e})}))},this.handleSubmit=()=>{const{dataSource:e}=this.state,{id:t}=this.props,i=this.props.config.layersConfig.find((e=>e.id===this.state.activeTabId)),a=this.getQueryOptions(i);e.updateQueryParams(a,t)},this.onKeyUp=e=>{e&&e.target&&"Enter"===e.key&&this.setState({isShowSuggestion:!1},(()=>{this.handleSubmit()}))},this.getTextInputPrefixElement=()=>{const{theme:e}=this.props;return(0,o.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.setState({isShowSuggestion:!1},(()=>{this.handleSubmit()}))},className:"search-icon"},(0,o.jsx)(f,{color:e.colors.palette.light[800]}))},this.renderSearchTools=e=>{const{searchText:t,searchToolFlag:i,isOpenSearchPopper:a}=this.state,{theme:s}=this.props;return(0,o.jsx)("div",{className:"table-search-div"},i?(0,o.jsx)("div",{className:"float-right",ref:e=>this.refs.searchPopup=e},(0,o.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:this.formatMessage("search"),onClick:e=>{this.setState({isOpenSearchPopper:!a})}},(0,o.jsx)(f,null)),(0,o.jsx)(n.Popper,{placement:"right-start",reference:this.refs.searchPopup,offset:[-10,-30],open:a,showArrow:!1,toggle:e=>{this.setState({isOpenSearchPopper:!a})}},(0,o.jsx)("div",{className:"d-flex align-items-center table-popup-search m-2"},(0,o.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.setState({isOpenSearchPopper:!1})},className:"search-back mr-1"},(0,o.jsx)(w,{color:s.colors.palette.dark[800]})),(0,o.jsx)(n.TextInput,{className:"popup-search-input",placeholder:e||this.formatMessage("search"),onChange:e=>{this.handleChange(e.target.value)},value:t||"",onKeyDown:e=>{this.onKeyUp(e)},prefix:this.getTextInputPrefixElement(),allowClear:!0,title:e||this.formatMessage("search")})))):(0,o.jsx)("div",{className:"d-flex align-items-center table-search"},(0,o.jsx)(n.TextInput,{className:"search-input",placeholder:e||this.formatMessage("search"),onChange:e=>{this.handleChange(e.target.value)},value:t||"",onKeyDown:e=>{this.onKeyUp(e)},prefix:this.getTextInputPrefixElement(),allowClear:!0,title:e||this.formatMessage("search")})))},this.getInitFields=()=>{const{activeTabId:e,dataSource:t}=this.state,{config:a}=this.props,{layersConfig:o}=a,s=this.getDataActionTable(),l=o.asMutable({deep:!0}).concat(s).find((t=>t.id===e)),{tableFields:n,allFields:r,layerHonorMode:d}=l,c=[];if(d===i.Webmap&&t){const e=null==t?void 0:t.getPopupInfo();if(e){const t=e.fieldInfos||[];for(const e of t)c.push({value:e.fieldName,label:e.label})}else for(const e of r)c.push({value:e.name,label:e.alias})}else for(const e of n)e.visible&&c.push({value:e.name,label:e.alias});return c},this.onValueChangeFromRuntime=e=>{e||(e=[]);const{tableShowColumns:t}=this.state,i=this.getInitFields(),a=t||i,o=e.length>a.length;p(a,e,"value").forEach((e=>{o?this.table.showColumn(e.value):this.table.hideColumn(e.value)})),this.setState({tableShowColumns:e})},this.getDataActionTable=()=>{const{viewInTableObj:e}=this.props,t=[];for(const i in e){const a=e[i];this.dataActionTableRecords[i]=a.records,t.push(Object.assign({},a.daLayerItem))}return t},this.onCloseTab=(e,t)=>{const{id:i,viewInTableObj:a}=this.props;t&&t.stopPropagation(),this.removeConfig=!0,this.setState({tableShowColumns:void 0});const s=a;delete s[e],delete this.dataActionTableRecords[e],o.MutableStoreManager.getInstance().updateStateValue(i,"viewInTableObj",s)},this.getLoadingStatus=(e,t)=>{const{stateShowLoading:i}=this.props;let a=!1;return(i||window.jimuConfig.isInBuilder||e&&t===o.DataSourceStatus.Loading)&&(a=!0),a},this.setRefreshLoadingString=(e=!1)=>{if(!e)return!1;let t=0;const i=this;clearInterval(this.autoRefreshLoadingTime),this.autoRefreshLoadingTime=setInterval((()=>{t++,i.setState({autoRefreshLoadingString:i.getLoadingString(t)})}),6e4)},this.getLoadingString=e=>{let t=this.formatMessage("lastUpdateAFewTime");return e>1&&e<=2?t=this.formatMessage("lastUpdateAMinute"):e>2&&(t=this.formatMessage("lastUpdateTime",{updateTime:e})),t},this.toggleAutoRefreshLoading=(e,t,i)=>{this.resetAutoRefreshTimes(i,t),i>0&&this.setRefreshLoadingString(t)},this.resetAutoRefreshTimes=(e,t=!1)=>{const i=this;clearTimeout(this.resetAutoRefreshTime),e<=0&&clearInterval(this.autoRefreshLoadingTime),this.resetAutoRefreshTime=setTimeout((()=>{t&&e>0&&i.setState({autoRefreshLoadingString:i.formatMessage("lastUpdateAFewTime")}),i.setState({showLoading:t})}),0)},this.renderLoading=(e,t)=>{var i;const{autoRefreshLoadingString:a,bottomResponsiveFlag:s,widgetWidth:l}=this.state,r=(null===(i=this.refs.countContainer)||void 0===i?void 0:i.clientWidth)||0,d=s?20:l-r-16;return(0,o.jsx)("div",{className:"position-absolute refresh-loading-con d-flex align-items-center",style:{maxWidth:d}},e&&(0,o.jsx)("div",{className:"loading-con"}),t>0&&(0,o.jsx)("div",{className:"flex-grow-1 auto-refresh-loading text-truncate",title:!s&&a},s?(0,o.jsx)(n.Tooltip,{title:a,showArrow:!0,placement:"top-end"},(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"tertiary",className:"d-inline jimu-outline-inside border-0 p-0"},(0,o.jsx)(J,{size:14}))):a))},this.renderTableCount=(e,t)=>{const{bottomResponsiveFlag:i,widgetWidth:a}=this.state,s=i?a-36:a/2;return(0,o.jsx)("div",{ref:"countContainer",className:"position-absolute table-count d-flex align-items-center",style:{maxWidth:s}},(0,o.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate"},this.formatMessage("tableCount",{total:e,selected:t})))},this.onSuggestionConfirm=e=>{this.setState({searchText:e,isShowSuggestion:!1},(()=>{this.handleSubmit()}))},this.clearMessageAction=()=>{o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(this.props.id,[])),this.setState({emptyData:!1})},this.customShowHideButton=()=>(0,o.jsx)(R,null),this.customShowHideDropdownButton=()=>(0,o.jsx)(Q.Fragment,null,(0,o.jsx)(R,{className:"mr-1"}),this.formatMessage("showHideCols")),this.getUsedFields=(e,t)=>{var a;if(!e)return{popupAllFields:[],actionUsedFields:[]};const o=[];if(t){const i=null==t?void 0:t.getSchema(),s=Object.keys(null==i?void 0:i.fields),l=null==t?void 0:t.getPopupInfo();if(l){const e=(l.fieldInfos||[]).filter((e=>s.includes(e.fieldName)));for(const t of e)t.visible&&o.push({value:t.fieldName,label:t.label||t.fieldName})}else{const i=null===(a=null==t?void 0:t.getLayerDefinition())||void 0===a?void 0:a.fields,l=((null==i?void 0:i.length)>0?i:e.allFields).filter((e=>s.includes(e.jimuName||e.name)));for(const e of l)o.push({value:e.name,label:e.alias||e.name})}}const s=e.layerHonorMode===i.Webmap?o.map((e=>e.value)):e.tableFields.map((e=>e.jimuName));return{popupAllFields:o,actionUsedFields:s}},this.renderButtonToolList=(e,t)=>{var a;const{activeTabId:s,selectQueryFlag:l,tableShowColumns:r,mobileFlag:d,emptyTable:c,notAllowDel:u,tableLoaded:h,tableSelected:v}=this.state,{config:p,id:g,enableDataAction:m}=this.props,{layersConfig:b}=p,f=v>0,S=this.getInitFields(),y=this.getDataActionTable(),w=b.asMutable({deep:!0}).concat(y),x=e.layerHonorMode===i.Webmap,T=null===(a=e.tableFields)||void 0===a?void 0:a.map((e=>({value:e.name,label:e.alias}))),{popupAllFields:j,actionUsedFields:I}=this.getUsedFields(e,t),C=null==t?void 0:t.getLabel(),O=this.formatMessage("tableDataActionLabel",{layer:C||""});return(0,o.jsx)("div",{className:"top-button-list"},e.enableSelect&&(0,o.jsx)("div",{className:"top-button ml-2"},(0,o.jsx)(n.Button,{size:"sm",onClick:this.onShowSelection,icon:!0,title:l?this.formatMessage("showAll"):this.formatMessage("showSelection"),disabled:!h||c||!f},l?(0,o.jsx)(A,null):(0,o.jsx)(U,{autoFlip:!0}))),e.enableSelect&&(0,o.jsx)("div",{className:"top-button ml-2"},(0,o.jsx)(n.Button,{size:"sm",onClick:this.onSelectionClear,icon:!0,title:this.formatMessage("clearSelection"),disabled:!h||c||!f},(0,o.jsx)(M,null))),e.enableRefresh&&(0,o.jsx)("div",{className:"top-button ml-2"},(0,o.jsx)(n.Button,{size:"sm",onClick:this.onTableRefresh,icon:!0,title:this.formatMessage("refresh"),disabled:!h||c},(0,o.jsx)(N,null))),e.enableEdit&&!u&&!1,(0,o.jsx)("div",{className:"top-button ml-2"},(0,o.jsx)(n.AdvancedSelect,{size:"sm",title:this.formatMessage("showHideCols"),buttonProps:{icon:!0,disabled:!h||c,arrow:!1},fluid:!0,staticValues:x?j:T,sortValuesByLabel:!1,isMultiple:!0,selectedValues:r||S,isEmptyOptionHidden:!1,onChange:this.onValueChangeFromRuntime,customDropdownButtonContent:this.customShowHideButton})),t&&!d&&m&&(0,o.jsx)(Q.Fragment,null,w.map((e=>e.id!==s||c?"":(0,o.jsx)(Q.Fragment,{key:e.id},(0,o.jsx)("span",{className:"tool-dividing-line"}),(0,o.jsx)("div",{className:"top-button data-action-btn"},(0,o.jsx)(n.DataActionList,{widgetId:g,listStyle:n.DataActionListStyle.Dropdown,dataSets:[{dataSource:t,type:"selected",records:t.getSelectedRecords(),fields:I,name:O}]})))))))},this.renderDropdownToolList=(e,t)=>{var a;const{activeTabId:s,selectQueryFlag:l,tableShowColumns:r,mobileFlag:d,emptyTable:c,notAllowDel:u,tableLoaded:h,tableSelected:v}=this.state,{config:p,id:g,enableDataAction:m}=this.props,{layersConfig:b}=p,f=v>0,S=e.layerHonorMode===i.Webmap,y=null===(a=e.tableFields)||void 0===a?void 0:a.map((e=>({value:e.name,label:e.alias}))),w=this.getInitFields(),x=this.getDataActionTable(),T=b.asMutable({deep:!0}).concat(x),{popupAllFields:j,actionUsedFields:I}=this.getUsedFields(e,t),C=null==t?void 0:t.getLabel(),O=this.formatMessage("tableDataActionLabel",{layer:C||""});return(0,o.jsx)("div",{className:"d-flex ml-2 dropdown-list-container"},(0,o.jsx)(n.Dropdown,{size:"sm",className:"d-inline-flex dropdown-list"},(0,o.jsx)(n.DropdownButton,{arrow:!1,icon:!0,size:"sm",title:this.formatMessage("options")},(0,o.jsx)($,null)),(0,o.jsx)(n.DropdownMenu,null,e.enableSelect&&(0,o.jsx)(Q.Fragment,null,(0,o.jsx)(n.DropdownItem,{key:"showSelection",onClick:this.onShowSelection,disabled:!h||c||!f},l?(0,o.jsx)(A,{className:"mr-1"}):(0,o.jsx)(U,{className:"mr-1",autoFlip:!0}),l?this.formatMessage("showAll"):this.formatMessage("showSelection")),(0,o.jsx)(n.DropdownItem,{key:"clearSelection",onClick:this.onSelectionClear,disabled:!h||c||!f},(0,o.jsx)(M,{className:"mr-1"}),this.formatMessage("clearSelection"))),e.enableRefresh&&(0,o.jsx)(n.DropdownItem,{key:"refresh",onClick:this.onTableRefresh,disabled:!h||c},(0,o.jsx)(N,{className:"mr-1"}),this.formatMessage("refresh")),e.enableEdit&&!u&&!1,(0,o.jsx)(n.DropdownItem,{key:"showHideCols",tag:"div",toggle:!1,disabled:!h||c},(0,o.jsx)(n.AdvancedSelect,{size:"sm",title:this.formatMessage("showHideCols"),buttonProps:{arrow:!1,type:"tertiary",className:"p-0 table-hide-hover-color"},fluid:!0,staticValues:S?j:y,sortValuesByLabel:!1,isMultiple:!0,selectedValues:r||w,isEmptyOptionHidden:!1,onChange:this.onValueChangeFromRuntime,customDropdownButtonContent:this.customShowHideDropdownButton})))),t&&d&&m&&(0,o.jsx)(Q.Fragment,null,T.map((e=>e.id!==s||c?"":(0,o.jsx)(Q.Fragment,{key:e.id},(0,o.jsx)("span",{className:"tool-dividing-line"}),(0,o.jsx)("div",{className:"horizontal-action-dropdown"},(0,o.jsx)(n.DataActionList,{widgetId:g,listStyle:n.DataActionListStyle.Dropdown,dataSets:[{dataSource:t,type:"selected",records:t.getSelectedRecords(),fields:I,name:O}]})))))))},this.state={apiLoaded:!1,dataSource:void 0,activeTabId:void 0,downloadOpen:!1,searchText:"",selectQueryFlag:!1,mobileFlag:!1,searchToolFlag:!1,bottomResponsiveFlag:!1,tableShowColumns:void 0,isOpenSearchPopper:!1,emptyTable:!1,emptyData:!1,selectRecords:[],notReady:!1,selfDsChange:!1,showLoading:!1,interval:0,autoRefreshLoadingString:"",isShowSuggestion:!1,searchSuggestion:[],notAllowDel:!0,tableLoaded:!1,tableTotal:0,tableSelected:0,widgetWidth:(null===(l=null===(s=null==e?void 0:e.manifest)||void 0===s?void 0:s.defaultSize)||void 0===l?void 0:l.width)||600,isTableEditing:!1},this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.dataActionTableRecords={},this.updatingTable=!1,this.removeConfig=!1,this.currentRequestId=0,this.viewTableId=0,this.timerFn=null,this.tableSourceVersion=void 0,this.lastSql="",this.debounceOnResize=o.lodash.debounce(((e,t)=>{this.onToolStyleChange(e,t)}),200),this.dsManager=o.DataSourceManager.getInstance()}static getDerivedStateFromProps(e,t){var i;const{config:a}=e,{layersConfig:o}=a,{activeTabId:s}=t,l=new se(e).getDataActionTable(),n=o.asMutable({deep:!0}).concat(l);return(!s||n.findIndex((e=>e.id===s))<0)&&n.length>0?{activeTabId:null===(i=n[0])||void 0===i?void 0:i.id}:null}componentDidMount(){this.state.apiLoaded||(0,l.loadArcGISJSAPIModules)(["esri/widgets/FeatureTable","esri/layers/FeatureLayer","esri/widgets/FeatureTable/support/TableTemplate","esri/geometry/geometryEngine","esri/geometry/Polygon"]).then((e=>{[this.FeatureTable,this.FeatureLayer,this.TableTemplate,this.geometryEngine,this.Polygon]=e,this.setState({apiLoaded:!0}),this.destoryTable().then((()=>{this.createTable()}))}))}componentWillUnmount(){const{id:e}=this.props;this.promises.forEach((e=>{e.cancel()})),this.destoryTable(),clearTimeout(this.suggestionsQueryTimeout),clearInterval(this.autoRefreshLoadingTime),o.MutableStoreManager.getInstance().updateStateValue(e,"viewInTableObj",{})}componentDidUpdate(e,t){var i,a,s,l,n,r,d;const{activeTabId:c,dataSource:u,tableLoaded:h}=this.state,{id:v,config:p,currentPageId:g,state:m,appMode:b,viewInTableObj:f}=this.props,{layersConfig:S}=p,y=this.getDataActionTable(),w=S.asMutable({deep:!0}).concat(y),x=null===(a=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===a?void 0:a.dataActionActiveObj,T=(null==x?void 0:x.dataActionTable)?null==x?void 0:x.activeTabId:c;this.onSettingChangeRuntime(),this.onFilterChange(T);const j=(null===(l=null===(s=this.props)||void 0===s?void 0:s.stateProps)||void 0===l?void 0:l.settingChangeTab)||!1,I=null===(r=null===(n=this.props)||void 0===n?void 0:n.stateProps)||void 0===r?void 0:r.activeTabId;j&&I&&c!==I&&(this.props.dispatch(o.appActions.widgetStatePropChange(v,"settingChangeTab",!1)),b===o.AppMode.Run&&this.onTagClick(I));const C=m===o.WidgetState.Closed,A=e.currentPageId!==g,O=e.appMode===o.AppMode.Run&&b===o.AppMode.Design;(C||A||O)&&this.table&&(this.table.menu.open=!1,this.setState({searchText:"",isShowSuggestion:!1}));const D=null===(d=e.config.layersConfig)||void 0===d?void 0:d.asMutable({deep:!0}).concat(y).find((e=>e.id===t.activeTabId)),M=w.find((e=>e.id===T)),z=this.dsManager.getDataSource(null==u?void 0:u.id);if(this.removeConfig){if(this.removeConfig=!1,!M)return}else{const e=f&&Object.keys(f);if(0===(null==e?void 0:e.length)&&!D||!M)return}const F=(null==D?void 0:D.enableSearch)&&(null==D?void 0:D.searchFields),N=(null==M?void 0:M.enableSearch)&&(null==M?void 0:M.searchFields);F&&!N&&z&&u.updateQueryParams(ee,v);const L=this.settingOptionsChange(D,M),P=!(null==x?void 0:x.dataActionTable)&&(null==D?void 0:D.id)!==(null==M?void 0:M.id),R=(null==D?void 0:D.id)===(null==M?void 0:M.id)&&L;if(P||R)return this.updatingTable=!0,void this.setState({searchText:"",isShowSuggestion:!1,tableShowColumns:void 0,selectQueryFlag:!1},(()=>{z&&(null==u||u.updateQueryParams(ee,v)),this.destoryTable().then((()=>{this.createTable()}))}));(null==x?void 0:x.dataActionTable)&&this.dataActionCanLoad&&!this.updatingTable&&(this.dataActionCanLoad=!1,this.props.dispatch(o.appActions.widgetStatePropChange(v,"dataActionActiveObj",{activeTabId:T,dataActionTable:!1})),this.updatingTable=!0,this.setState({activeTabId:T,searchText:"",tableShowColumns:void 0},(()=>{z&&(null==u||u.updateQueryParams(ee,v)),this.destoryTable().then((()=>{this.createTable()}))}))),h&&!t.tableLoaded&&this.lastSql&&(this.table.layer.definitionExpression=this.lastSql,this.lastSql="")}destoryTable(){return K(this,void 0,void 0,(function*(){this.table&&(this.table.menu.open=!1,!this.table.destroyed&&this.table.destroy()),this.refs.tableContainer&&(this.refs.tableContainer.innerHTML=""),yield Promise.resolve()}))}render(){var t,i,l,r;const{activeTabId:c,mobileFlag:u,emptyTable:h,notReady:p,showLoading:m,interval:b,isShowSuggestion:f,searchSuggestion:S,tableTotal:y,tableSelected:w}=this.state;let{dataSource:x}=this.state;const{config:T,id:I,theme:C,enableDataAction:A,isHeightAuto:O,isWidthAuto:D}=this.props,{layersConfig:M,arrangeType:z}=T,F=this.getDataActionTable(),N=M.asMutable({deep:!0}).concat(F);let L;const P=N.find((e=>e.id===c));(null==P?void 0:P.dataActionDataSource)&&(x=P.dataActionDataSource),N.length>0&&(L=P?P.useDataSource:N[0].useDataSource);const R=(0,o.classNames)("jimu-widget","widget-table","table-widget-"+I);if(0===N.length)return(0,o.jsx)(n.WidgetPlaceholder,{widgetId:I,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:te,"data-testid":"tablePlaceholder"});const E=z===e.Tabs,V=null==x?void 0:x.getLabel(),H=o.appConfigUtils.getWidgetIdByOutputDataSource(L),B=null===(t=(0,o.getAppStore)().getState())||void 0===t?void 0:t.appConfig,U=null===(l=null===(i=null==B?void 0:B.widgets)||void 0===i?void 0:i[H])||void 0===l?void 0:l.label,_={id:I,enableDataAction:A,isHeightAuto:O,isWidthAuto:D,headerFontSetting:null==P?void 0:P.headerFontSetting,emptyTable:h,horizontalTag:E},k=(null==P?void 0:P.enableSearch)&&0!==(null===(r=null==P?void 0:P.searchFields)||void 0===r?void 0:r.length),$=u?this.renderDropdownToolList(P,x):this.renderButtonToolList(P,x),W=P.dataActionObject&&P.dataActionType===a.View;return(0,o.jsx)("div",{className:R,css:v(C,u,k,_),ref:e=>this.refs.currentEl=e},(0,o.jsx)("div",{className:"surface-1 border-0 h-100"},(0,o.jsx)("div",{className:"table-indent"},(0,o.jsx)("div",{className:"d-flex "+(E?"horizontal-tag-list":"dropdown-tag-list")},E?(0,o.jsx)(Q.Fragment,null,(0,o.jsx)(n.Tabs,{type:"underline",onChange:this.onTagClick,className:"tab-flex",value:c,onClose:this.onCloseTab,scrollable:!0},N.map((e=>{const t=!!e.dataActionObject;return(0,o.jsx)(n.Tab,{key:e.id,id:e.id,title:e.name,className:"text-truncate tag-size",closeable:t},(0,o.jsx)("div",{className:"mt-2"}))})))):(0,o.jsx)(n.Select,{size:"sm",value:c,onChange:this.handleTagChange,className:"top-drop"},N.map((e=>(0,o.jsx)("option",{key:e.id,value:e.id,title:e.name},(0,o.jsx)("div",{className:"table-action-option"},(0,o.jsx)("div",{className:"table-action-option-tab",title:e.name},e.name),e.dataActionObject&&(0,o.jsx)("div",{className:"table-action-option-close"},(0,o.jsx)(n.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>{this.onCloseTab(e.id,t)}},(0,o.jsx)(j,{size:"s"})))))))),!k&&$),(0,o.jsx)("div",{className:z===e.Tabs?"horizontal-render-con":"dropdown-render-con"},k&&this.renderSearchTools(null==P?void 0:P.searchHint),k&&(0,o.jsx)("div",{ref:"suggestPopup",style:{position:"relative",top:25}},(0,o.jsx)(n.Popper,{css:o.css`
    & {
      max-height: ${o.polished.rem(300)};
      min-width: ${o.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:this.refs.suggestPopup,offset:[0,8],open:f,trapFocus:!1,autoFocus:!1,toggle:e=>{this.setState({isShowSuggestion:!f})}},S.map(((e,t)=>{const i=ae.sanitize(e.suggestionHtml);return(0,o.jsx)(n.Button,{key:t,type:"secondary",size:"sm",onClick:()=>{this.onSuggestionConfirm(e.suggestion)},dangerouslySetInnerHTML:{__html:i}})})))),k&&$,h&&(0,o.jsx)("div",{className:"placeholder-table-con"},(0,o.jsx)(n.WidgetPlaceholder,{icon:d(47001),message:this.formatMessage("noData")}),p&&(0,o.jsx)("div",{className:"placeholder-alert-con"},(0,o.jsx)(n.Alert,{form:"tooltip",size:"small",type:"warning",text:this.formatMessage("outputDataIsNotGenerated",{outputDsLabel:V,sourceWidgetName:U})}))),(0,o.jsx)("div",{ref:"tableContainer",className:"table-con"}),(null==P?void 0:P.updateText)&&(m||b>0)&&this.renderLoading(m,b),(null==P?void 0:P.showCount)&&this.renderTableCount(y,w),(0,o.jsx)("div",{className:"ds-container"},(x||L)&&(0,o.jsx)(o.DataSourceComponent,{widgetId:I,useDataSource:(0,o.Immutable)(L),dataSource:W?x:null,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onQueryRequired:this.onQueryRequired})),(0,o.jsx)(s.Global,{styles:g(C)})))),(0,o.jsx)(o.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize}))}}se.versionManager=u,se.mapExtraStateProps=(e,t)=>{var i,a,o,s,l,n,r,d,c,u,v,p,g,m,b,f,S,y,w,x,T,j,I,C,A;const{layoutId:O,layoutItemId:D,id:M}=t,z=null===(a=null===(i=null==e?void 0:e.appConfig)||void 0===i?void 0:i.widgets)||void 0===a?void 0:a[M],F=null==z?void 0:z.enableDataAction,N=null===(o=(e&&e.appConfig).layouts)||void 0===o?void 0:o[O],L=null===(l=null===(s=null==N?void 0:N.content)||void 0===s?void 0:s[D])||void 0===l?void 0:l.setting,P=(null===(n=null==L?void 0:L.autoProps)||void 0===n?void 0:n.height)===h.LayoutItemSizeModes.Auto||!0===(null===(r=null==L?void 0:L.autoProps)||void 0===r?void 0:r.height),R=(null===(d=null==L?void 0:L.autoProps)||void 0===d?void 0:d.width)===h.LayoutItemSizeModes.Auto||!0===(null===(c=null==L?void 0:L.autoProps)||void 0===c?void 0:c.width),E={},V=null===(u=null==t?void 0:t.mutableStateProps)||void 0===u?void 0:u.viewInTableObj;for(const e in V){const t=null===(m=null===(g=null===(p=null===(v=V[e])||void 0===v?void 0:v.daLayerItem)||void 0===p?void 0:p.dataActionDataSource)||void 0===g?void 0:g.dataSourceJson)||void 0===m?void 0:m.label;t&&(V[e].daLayerItem.name=t);const i=null===(S=null===(f=null===(b=V[e])||void 0===b?void 0:b.daLayerItem)||void 0===f?void 0:f.dataActionDataSource)||void 0===S?void 0:S.id,a=null===(x=null===(w=null===(y=V[e])||void 0===y?void 0:y.daLayerItem)||void 0===w?void 0:w.dataActionDataSource)||void 0===x?void 0:x.getInfo();E[`runtime-usedDs-info_${i}`]=a}return Object.assign(Object.assign({appMode:null===(T=null==e?void 0:e.appRuntimeInfo)||void 0===T?void 0:T.appMode,isRTL:null===(j=null==e?void 0:e.appContext)||void 0===j?void 0:j.isRTL,stateShowLoading:null===(C=null===(I=null==e?void 0:e.widgetsState)||void 0===I?void 0:I[t.id])||void 0===C?void 0:C.showLoading,currentPageId:null===(A=null==e?void 0:e.appRuntimeInfo)||void 0===A?void 0:A.currentPageId,viewInTableObj:V,enableDataAction:void 0===F||F},E),{isHeightAuto:P,isWidthAuto:R})};const le=se;function ne(e){d.p=e}})(),c})())}}}));