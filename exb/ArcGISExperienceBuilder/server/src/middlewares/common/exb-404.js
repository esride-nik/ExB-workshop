"use strict";var __awaiter=this&&this.__awaiter||function(t,u,i,s){return new(i=i||Promise)(function(n,e){function r(t){try{o(s.next(t))}catch(t){e(t)}}function a(t){try{o(s.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(r,a)}o((s=s.apply(t,u||[])).next())})},__generator=this&&this.__generator||function(r,a){var o,u,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},c={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function t(n){return function(t){var e=[n,t];if(o)throw new TypeError("Generator is already executing.");for(;s=c&&e[c=0]?0:s;)try{if(o=1,u&&(i=2&e[0]?u.return:e[0]?u.throw||((i=u.return)&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;switch(u=0,(e=i?[2&e[0],i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,u=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3]))s.label=e[1];else if(6===e[0]&&s.label<i[1])s.label=i[1],i=e;else{if(!(i&&s.label<i[2])){i[2]&&s.ops.pop(),s.trys.pop();continue}s.label=i[2],s.ops.push(e)}}e=a.call(r,s)}catch(t){e=[6,t],u=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},path=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.handle404=void 0,require("path")),path_utils_1=require("./path-utils");function handle404(i){return function(o,u){return __awaiter(this,void 0,void 0,function(){var e,n,r,a;return __generator(this,function(t){switch(t.label){case 0:return e=i.urlPath,n=i.path,r=o.path,e==="".concat(i.mountPath,"site/")&&(r!==i.mountPath&&r!=="".concat(i.mountPath,"page/set-portalurl")&&r!=="".concat(i.mountPath,"page/landing")||(r="".concat(i.mountPath,"site")),n=n.substr(0,n.length-"site/".length)),new RegExp("^".concat(e)).test((0,path_utils_1.fixPath)(r))?[3,2]:[4,u()];case 1:return t.sent(),[2];case 2:return 404===o.response.status?[3,4]:[4,u()];case 3:return t.sent(),[2];case 4:return(0,path_utils_1.isIndexPath)(r,e)?(o.res.setHeader("Cache-Control","no-cache"),a=o.response,[4,(0,path_utils_1.readAndreplaceContent)(path.join(n,"index.html"))]):[3,6];case 5:return a.body=t.sent(),[2];case 6:return[4,u()];case 7:return t.sent(),[2]}})})}}require("../../global"),exports.handle404=handle404;